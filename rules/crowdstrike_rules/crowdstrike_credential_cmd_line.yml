AnalysisType: rule
RuleID: "Crowdstrike.Command.Credentials"
Description: Detect when credentials are being passed on the commandline
DisplayName: "Crowdstrike Credential Usage on Command Line"
Filename: crowdstrike_credential_cmd_line.py
DedupPeriodMinutes: 60
Threshold: 1
LogTypes:
    - Crowdstrike.FDREvent
Enabled: true
Severity: High
Tests:
    - Name: Crowdstrike wget (Positive)
      ExpectedResult: true
      Log:
        {
            "aid": "abcdefg1234567890",
            "aip": "1.1.1.1",
            "cid": "abcdefg1234567890",
            "configbuild": "1007.4.0016702.11",
            "configstatehash": "3055027664",
            "entitlements": "15",
            "event": {
                "CodeSigningFlags": "570425859",
                "CommandLine": "wget --user=username --password=password http://example.com",
                "ConfigBuild": "1007.4.0016702.11",
                "ConfigStateHash": "3055027664",
                "EffectiveTransmissionClass": "2",
                "Entitlements": "15",
                "GID": "20",
                "ImageFileName": "/opt/homebrew/Cellar/wget/1.21.3_1/bin/wget",
                "MD5HashData": "cb96c40d1200ade02b3a725a2685f631",
                "MachOSubType": "1",
                "ParentBaseFileName": "zsh",
                "ParentProcessId": "483440741198618902",
                "ProcessEndTime": "",
                "ProcessGroupId": "483749864269237552",
                "ProcessStartTime": "1682983746.532",
                "RGID": "501",
                "RUID": "501",
                "RawProcessId": "50231",
                "SHA1HashData": "0000000000000000000000000000000000000000",
                "SHA256HashData": "9c6fc5eca355d418df097402ad547cee8c898f1a3f71dc2efb3b55afd9557d1a",
                "SVGID": "20",
                "SVUID": "501",
                "SessionProcessId": "483440741103198485",
                "SigningId": "wget-5555494443efb592d23b32cab28d9c8b9c32f042",
                "SourceProcessId": "483440741198618902",
                "SourceThreadId": "0",
                "Tags": "316",
                "TargetProcessId": "483749864269237552",
                "TeamId": "-",
                "UID": "501",
                "aid": "abcdefg1234567890",
                "aip": "1.1.1.1",
                "cid": "abcdefg1234567890",
                "event_platform": "Mac",
                "event_simpleName": "ProcessRollup2",
                "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
                "name": "ProcessRollup2MacV8",
                "timestamp": "1682983746620"
            },
            "event_platform": "Mac",
            "event_simplename": "ProcessRollup2",
            "fdr_event_type": "ProcessRollup2",
            "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
            "name": "ProcessRollup2MacV8",
            "p_log_type": "Crowdstrike.FDREvent",
            "timestamp": "2023-05-01 23:29:06.62"
        }
    - Name: Crowdstrike curl (Positive)
      ExpectedResult: true
      Log:
        {
            "aid": "abcdefg1234567890",
            "aip": "1.1.1.1",
            "cid": "abcdefg1234567890",
            "configbuild": "1007.4.0016702.11",
            "configstatehash": "3055027664",
            "entitlements": "15",
            "event": {
                "CodeSigningFlags": "570425859",
                "CommandLine": "curl -u username:password http://example.com",
                "ConfigBuild": "1007.4.0016702.11",
                "ConfigStateHash": "3055027664",
                "EffectiveTransmissionClass": "2",
                "Entitlements": "15",
                "GID": "20",
                "ImageFileName": "/usr/bin/curl",
                "MD5HashData": "cb96c40d1200ade02b3a725a2685f631",
                "MachOSubType": "1",
                "ParentBaseFileName": "zsh",
                "ParentProcessId": "483440741198618902",
                "ProcessEndTime": "",
                "ProcessGroupId": "483749864269237552",
                "ProcessStartTime": "1682983746.532",
                "RGID": "501",
                "RUID": "501",
                "RawProcessId": "50231",
                "SHA1HashData": "0000000000000000000000000000000000000000",
                "SHA256HashData": "9c6fc5eca355d418df097402ad547cee8c898f1a3f71dc2efb3b55afd9557d1a",
                "SVGID": "20",
                "SVUID": "501",
                "SessionProcessId": "483440741103198485",
                "SigningId": "wget-5555494443efb592d23b32cab28d9c8b9c32f042",
                "SourceProcessId": "483440741198618902",
                "SourceThreadId": "0",
                "Tags": "316",
                "TargetProcessId": "483749864269237552",
                "TeamId": "-",
                "UID": "501",
                "aid": "abcdefg1234567890",
                "aip": "1.1.1.1",
                "cid": "abcdefg1234567890",
                "event_platform": "Mac",
                "event_simpleName": "ProcessRollup2",
                "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
                "name": "ProcessRollup2MacV8",
                "timestamp": "1682983746620"
            },
            "event_platform": "Mac",
            "event_simplename": "ProcessRollup2",
            "fdr_event_type": "ProcessRollup2",
            "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
            "name": "ProcessRollup2MacV8",
            "p_log_type": "Crowdstrike.FDREvent",
            "timestamp": "2023-05-01 23:29:06.62"
        }
    - Name: Crowdstrike ftp (Positive)
      ExpectedResult: true
      Log:
        {
            "aid": "abcdefg1234567890",
            "aip": "1.1.1.1",
            "cid": "abcdefg1234567890",
            "configbuild": "1007.4.0016702.11",
            "configstatehash": "3055027664",
            "entitlements": "15",
            "event": {
                "CodeSigningFlags": "570425859",
                "CommandLine": "ftp username:password@example.com",
                "ConfigBuild": "1007.4.0016702.11",
                "ConfigStateHash": "3055027664",
                "EffectiveTransmissionClass": "2",
                "Entitlements": "15",
                "GID": "20",
                "ImageFileName": "/usr/bin/ftp",
                "MD5HashData": "cb96c40d1200ade02b3a725a2685f631",
                "MachOSubType": "1",
                "ParentBaseFileName": "zsh",
                "ParentProcessId": "483440741198618902",
                "ProcessEndTime": "",
                "ProcessGroupId": "483749864269237552",
                "ProcessStartTime": "1682983746.532",
                "RGID": "501",
                "RUID": "501",
                "RawProcessId": "50231",
                "SHA1HashData": "0000000000000000000000000000000000000000",
                "SHA256HashData": "9c6fc5eca355d418df097402ad547cee8c898f1a3f71dc2efb3b55afd9557d1a",
                "SVGID": "20",
                "SVUID": "501",
                "SessionProcessId": "483440741103198485",
                "SigningId": "wget-5555494443efb592d23b32cab28d9c8b9c32f042",
                "SourceProcessId": "483440741198618902",
                "SourceThreadId": "0",
                "Tags": "316",
                "TargetProcessId": "483749864269237552",
                "TeamId": "-",
                "UID": "501",
                "aid": "abcdefg1234567890",
                "aip": "1.1.1.1",
                "cid": "abcdefg1234567890",
                "event_platform": "Mac",
                "event_simpleName": "ProcessRollup2",
                "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
                "name": "ProcessRollup2MacV8",
                "timestamp": "1682983746620"
            },
            "event_platform": "Mac",
            "event_simplename": "ProcessRollup2",
            "fdr_event_type": "ProcessRollup2",
            "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
            "name": "ProcessRollup2MacV8",
            "p_log_type": "Crowdstrike.FDREvent",
            "timestamp": "2023-05-01 23:29:06.62"
        }
    - Name: Crowdstrike wget (Negative)
      ExpectedResult: false
      Log:
        {
            "aid": "abcdefg1234567890",
            "aip": "1.1.1.1",
            "cid": "abcdefg1234567890",
            "configbuild": "1007.4.0016702.11",
            "configstatehash": "3055027664",
            "entitlements": "15",
            "event": {
                "CodeSigningFlags": "570425859",
                "CommandLine": "wget --user=username http://example.com",
                "ConfigBuild": "1007.4.0016702.11",
                "ConfigStateHash": "3055027664",
                "EffectiveTransmissionClass": "2",
                "Entitlements": "15",
                "GID": "20",
                "ImageFileName": "/opt/homebrew/Cellar/wget/1.21.3_1/bin/wget",
                "MD5HashData": "cb96c40d1200ade02b3a725a2685f631",
                "MachOSubType": "1",
                "ParentBaseFileName": "zsh",
                "ParentProcessId": "483440741198618902",
                "ProcessEndTime": "",
                "ProcessGroupId": "483749864269237552",
                "ProcessStartTime": "1682983746.532",
                "RGID": "501",
                "RUID": "501",
                "RawProcessId": "50231",
                "SHA1HashData": "0000000000000000000000000000000000000000",
                "SHA256HashData": "9c6fc5eca355d418df097402ad547cee8c898f1a3f71dc2efb3b55afd9557d1a",
                "SVGID": "20",
                "SVUID": "501",
                "SessionProcessId": "483440741103198485",
                "SigningId": "wget-5555494443efb592d23b32cab28d9c8b9c32f042",
                "SourceProcessId": "483440741198618902",
                "SourceThreadId": "0",
                "Tags": "316",
                "TargetProcessId": "483749864269237552",
                "TeamId": "-",
                "UID": "501",
                "aid": "abcdefg1234567890",
                "aip": "1.1.1.1",
                "cid": "abcdefg1234567890",
                "event_platform": "Mac",
                "event_simpleName": "ProcessRollup2",
                "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
                "name": "ProcessRollup2MacV8",
                "timestamp": "1682983746620"
            },
            "event_platform": "Mac",
            "event_simplename": "ProcessRollup2",
            "fdr_event_type": "ProcessRollup2",
            "id": "85e93348-a8b9-4326-aa82-a43ffebad808",
            "name": "ProcessRollup2MacV8",
            "p_log_type": "Crowdstrike.FDREvent",
            "timestamp": "2023-05-01 23:29:06.62"
        }